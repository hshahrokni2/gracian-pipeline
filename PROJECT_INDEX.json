{"at":"2025-10-06T11:17:16.044363","root":".","tree":[".","\u251c\u2500\u2500 data/ (9 files)","\u2502   \u2514\u2500\u2500 raw_pdfs/ (9 files)","\u2502       \u251c\u2500\u2500 Hjorthagen/","\u2502       \u2514\u2500\u2500 outputs/ (8 files)","\u2502           \u251c\u2500\u2500 agent_debug/ (4 files)","\u2502           \u2502   \u2514\u2500\u2500 brf_46160/ (4 files)","\u2502           \u2502       \u251c\u2500\u2500 financial_agent/ (2 files)","\u2502           \u2502       \u2514\u2500\u2500 property_agent/ (2 files)","\u2502           \u251c\u2500\u2500 coach_history/","\u2502           \u2514\u2500\u2500 sections/ (3 files)","\u251c\u2500\u2500 gracian_pipeline/ (11 files)","\u2502   \u251c\u2500\u2500 core/ (10 files)","\u2502   \u251c\u2500\u2500 data/","\u2502   \u2502   \u251c\u2500\u2500 outputs/","\u2502   \u2502   \u251c\u2500\u2500 raw_pdfs/","\u2502   \u2502   \u2514\u2500\u2500 zips/","\u2502   \u251c\u2500\u2500 prompts/ (1 files)","\u2502   \u251c\u2500\u2500 run/","\u2502   \u251c\u2500\u2500 schemas/"],"stats":{"total_files":18,"total_directories":8,"fully_parsed":{"python":15},"listed_only":{"json":2,"shell":1},"markdown_files":5},"f":{"analyze_pdf_topology.py":["p",["main:279:():analyze_database,analyze_directory,print_summary:"],{"PDFTopologyAnalyzer":["30",["__init__:31:(self)::","analyze_pdf:41:(self, pdf_path:str)>Dict[str, Any]::Analyze a single PDF and return its characteristics","analyze_directory:115:(self, directory:str, pattern:str = \"*.pdf\")>None:analyze_pdf:Analyze all PDFs in a directory","analyze_database:130:(self, db_url:str = None)>None::Query H100 PostgreSQL for PDF metadata","print_summary:200:(self)>None::Print analysis summary"]]}],"gracian_pipeline/core/bench.py":["p",["_num:10:(s:str)>Tuple[bool, float | None]::","score_output:95:(agent_id:str, data:Dict[str, Any])>float:_num:","call_gemini_text:131:(prompt:str, content:str)>str::","call_openai_text:163:(prompt:str, content:str)>str::","call_qwen_openrouter_text:216:(prompt:str, content:str)>str::","jury_rank:236:(agent_id:str, prompt:str, content:str, cand:Dict[str, str])>Dict[str, Any]::"]],"gracian_pipeline/core/enforce.py":["p",["_parse_num:12:(s:Any)>Tuple[bool, float | None]::","enforce:27:(agent_id:str, data:Dict[str, Any])>Tuple[Dict[str, Any], Dict[str, Any], Dict[str, Any]]:_parse_num:"]],"gracian_pipeline/core/oneshot.py":["p",["_sample_pages:16:(pdf_path:str, max_pages:int)>Tuple[List[int], List[bytes]]::Select up to max_pages spanning the document; return (indices, images).","_build_schema_block:37:(agent_ids:List[str])>str::","oneshot_extract:44:(pdf_path:str, agents:Dict[str, str])>Dict[str, Any]:_build_schema_block,_sample_pages:"]],"gracian_pipeline/core/orchestrator.py":["p",["_score_threshold:19:(agent_id:str)>float::","_distinct_ints:28:(seq:List[int])>List[int]::","_coach_sectionizer_once:32:(pdf_path:str, outline:Dict[str, Any])>Dict[str, Any]:_distinct_ints:","_coach_agent_once:74:(pdf_path:str, agent_id:str, pages:List[int], last_json:Dict[str, Any])>Dict[str, Any]:_distinct_ints:","_global_pick_pages_for_agent:109:(pdf_path:str, agent_id:str)>List[int]::As a last resort, sample pages across the whole document and ask GPT-5 to pic...","orchestrate_pdf:141:(pdf_path:str, agents:Dict[str, str], max_rounds:int = 5)>Dict[str, Any]:_append_history,_coach_agent_once,_coach_sectionizer_once,_distinct_ints,_global_pick_pages_for_agent,_hash_str,_process_single,_score_threshold:"]],"gracian_pipeline/core/qc.py":["p",["_to_float:8:(x:Any)>Tuple[bool, float | None]::","qc_financial:21:(d:Dict[str, Any], tol:float = 0.06)>Dict[str, Any]:_to_float:","qc_loans:48:(d:Dict[str, Any])>Dict[str, Any]:_to_float:","qc_reserves:63:(d:Dict[str, Any])>Dict[str, Any]:_to_float:","numeric_qc:75:(agent_id:str, d:Dict[str, Any])>Dict[str, Any]:qc_financial,qc_loans,qc_reserves:"]],"gracian_pipeline/core/schema.py":["p",["get_types:96:(agent_id:str)>Dict[str, str]::","schema_prompt_block:100:(agent_id:str)>str:get_types:"]],"gracian_pipeline/core/sectionizer.py":["p",["_normalize_text:44:(t:str)>str::","_scan_pages_for_anchors:49:(pdf_path:str)>Dict[int, Set[str]]:_normalize_text:Return mapping page_index -> matched agent_ids (by text anchors).","_group_consecutive:73:(pages:List[int])>List[Tuple[int, int]]::","sectionize_pdf:91:(pdf_path:str)>Dict[str, List[int]]:_normalize_text,_scan_pages_for_anchors:","select_pages_for_agent:147:(pdf_path:str, agent_id:str)>List[int]:sectionize_pdf:Helper to get page indices for a single agent."]],"gracian_pipeline/core/vertex.py":["p",["_load_sa_credentials:13:(path:str)::","_vertex_endpoint:20:(model:str, project:str, location:str)>str::","vertex_generate_text:25:(sa_path:str, project:str, location:str, model:str, prompt:str, content:str, timeout:int = 90)>str:_load_sa_credentials,_vertex_endpoint:","vertex_generate_vision:49:(sa_path:str, project:str, location:str, model:str, prompt:str, images_png:List[bytes], timeout:int = 90)>str:_load_sa_credentials,_vertex_endpoint:"]],"gracian_pipeline/core/vision_qc.py":["p",["_b64_png:11:(data:bytes)>str::","render_pdf_pages:15:(pdf_path:str, max_pages:int = 2, dpi:int = 200)>List[bytes]::Render first N pages of a PDF to PNG bytes using PyMuPDF (fitz).","render_pdf_pages_subset:35:(pdf_path:str, page_indices:List[int], dpi:int = 200)>List[bytes]::","json_guard:57:(text:str, default:Dict[str, Any] | None = None)>Dict[str, Any]::","call_grok_vision:88:(prompt:str, images_png:List[bytes])>str:_b64_png:Call xAI Grok (OpenAI-compatible) with image(s) and prompt; return text content.","call_gemini_vision:120:(prompt:str, images_png:List[bytes])>str:_b64_png:Call Gemini 2.5 Pro via REST with inline images; return text content. Retries...","call_qwen_openrouter_vision:159:(prompt:str, images_png:List[bytes])>str:_b64_png:Call Qwen vision via OpenRouter (OpenAI-compatible chat).","has_signal:197:(d:Dict[str, Any])>bool::True if any non-empty value present.","call_openai_vision:208:(prompt:str, images_png:List[bytes], page_labels:List[str] | None = None)>str:_b64_png:Call OpenAI Chat Completions with vision (image_url parts). Retries on transi...","call_openai_responses_vision:243:(prompt:str, images_png:List[bytes], page_labels:List[str] | None = None)>str:_b64_png:","vision_qc_agent:282:(pdf_path:str, agent_id:str, prompt:str, page_indices:List[int] | None = None)>Tuple[Dict[str, Any], Dict[str, Any]]:call_gemini_vision,call_grok_vision,call_openai_responses_vision,call_openai_vision,call_qwen_openrouter_vision,has_signal,json_guard,render_pdf_pages,render_pdf_pages_subset:"]],"gracian_pipeline/core/vision_sectionizer.py":["p",["render_all_pages:9:(pdf_path:str, dpi:int = 170)>List[bytes]::","_call_openai_compatible_vision:24:(base_url:str, api_key:str, model:str, prompt:str, images:List[bytes])>str::","_json_guard:41:(text:str, default:Any)>Any::","_batch_indices:73:(n:int, size:int)>List[Tuple[int, int]]::","_choose_sectionizer_provider:83:()>Tuple[str, str, str]::","vision_sectionize:100:(pdf_path:str)>Dict[str, Any]:_batch_indices,_call_openai_compatible_vision,_choose_sectionizer_provider,_json_guard,add_pages,contains,norm_title:Two-round vision sectionizer. Returns a dict with level_1, level_2, level_3 a..."]],"gracian_pipeline/prompts/agent_prompts.py":["p",["get_prompt:64:(agent_id)::"]],"mass_scan_pdfs.py":["p",["main:372:():load_from_checkpoint,print_summary,scan_directory:"],{"MassPDFScanner":["35",["__init__:45:(self, base_dir:str, checkpoint_db:str = \"scan_progress.db\"):_init_checkpoint_db:","_init_checkpoint_db:62:(self)::Initialize SQLite checkpoint database","_is_already_scanned:88:(self, filepath:str)>bool::Check if file was already scanned","_save_checkpoint:97:(self, filepath:str, result:Dict[str, Any])::Save file analysis to checkpoint database","analyze_pdf:115:(self, pdf_path:str)>Dict[str, Any]::Analyze a single PDF (same logic as analyze_pdf_topology.py)","_format_eta:184:(self, seconds:float)>str::Format ETA in human-readable form","scan_directory:195:(self, doc_type_key:str, batch_size:int = 5000):_format_eta,_is_already_scanned,_save_checkpoint,_save_intermediate_json,analyze_pdf:Scan all PDFs in a document type directory with batching","_save_intermediate_json:297:(self, doc_type_key:str, session_id:int, final:bool = False)::Save intermediate results to JSON","load_from_checkpoint:322:(self)>Dict[str, int]::Load stats from checkpoint database","print_summary:343:(self):_format_eta:Print analysis summary"]]}],"run_gracian.py":["p",["call_grok:35:(prompt, content)::Call Grok API with prompt and content","extract_pdf_text:55:(pdf_path)::Extract text from entire document using PyMuPDF; fallback to pdfplumber.","process_pdf:86:(pdf_path, agents):_num_ok,call_grok,extract_pdf_text:Process a single PDF with all agents","main:427:():_is_nonempty,process_pdf:"]],"tools/debug_agent.py":["p",["load_orchestrated_pages:42:(pdf_path:str, agent_id:str)>List[int]::","parse_pages_arg:61:(p:str)>List[int]::","chunk:74:(seq:List[int], size:int)>List[List[int]]::","main:78:()>None:chunk,load_orchestrated_pages,parse_pages_arg:"]]},"g":[["numeric_qc","qc_financial"],["vision_sectionize","_json_guard"],["vision_qc_agent","call_openai_responses_vision"],["MassPDFScanner.scan_directory","MassPDFScanner._save_intermediate_json"],["qc_reserves","_to_float"],["numeric_qc","qc_reserves"],["oneshot_extract","_build_schema_block"],["MassPDFScanner.scan_directory","MassPDFScanner._save_checkpoint"],["MassPDFScanner.scan_directory","MassPDFScanner.analyze_pdf"],["main","PDFTopologyAnalyzer.print_summary"],["main","analyze_database"],["call_openai_responses_vision","_b64_png"],["vertex_generate_text","_load_sa_credentials"],["vertex_generate_vision","_load_sa_credentials"],["PDFTopologyAnalyzer.analyze_directory","MassPDFScanner.analyze_pdf"],["vision_qc_agent","call_openai_vision"],["orchestrate_pdf","_coach_sectionizer_once"],["oneshot_extract","_sample_pages"],["vision_qc_agent","json_guard"],["call_grok_vision","_b64_png"],["vision_qc_agent","call_qwen_openrouter_vision"],["orchestrate_pdf","_global_pick_pages_for_agent"],["_scan_pages_for_anchors","_normalize_text"],["vision_qc_agent","render_pdf_pages_subset"],["main","chunk"],["vision_qc_agent","render_pdf_pages"],["MassPDFScanner.scan_directory","analyze_pdf"],["numeric_qc","qc_loans"],["main","PDFTopologyAnalyzer.analyze_database"],["vision_sectionize","_batch_indices"],["main","print_summary"],["orchestrate_pdf","_process_single"],["main","load_orchestrated_pages"],["sectionize_pdf","_normalize_text"],["PDFTopologyAnalyzer.analyze_directory","analyze_pdf"],["process_pdf","call_grok"],["process_pdf","extract_pdf_text"],["call_qwen_openrouter_vision","_b64_png"],["main","MassPDFScanner.load_from_checkpoint"],["qc_loans","_to_float"],["score_output","_num"],["main","PDFTopologyAnalyzer.analyze_directory"],["MassPDFScanner.scan_directory","_format_eta"],["MassPDFScanner.scan_directory","_is_already_scanned"],["MassPDFScanner.scan_directory","MassPDFScanner._format_eta"],["call_openai_vision","_b64_png"],["MassPDFScanner.print_summary","_format_eta"],["orchestrate_pdf","_hash_str"],["MassPDFScanner.print_summary","MassPDFScanner._format_eta"],["select_pages_for_agent","sectionize_pdf"],["vision_qc_agent","call_grok_vision"],["main","parse_pages_arg"],["MassPDFScanner.scan_directory","_save_checkpoint"],["vision_sectionize","_choose_sectionizer_provider"],["call_gemini_vision","_b64_png"],["vision_qc_agent","call_gemini_vision"],["MassPDFScanner.__init__","_init_checkpoint_db"],["schema_prompt_block","get_types"],["MassPDFScanner.__init__","MassPDFScanner._init_checkpoint_db"],["orchestrate_pdf","_score_threshold"],["main","scan_directory"],["main","load_from_checkpoint"],["MassPDFScanner.scan_directory","PDFTopologyAnalyzer.analyze_pdf"],["main","MassPDFScanner.print_summary"],["orchestrate_pdf","_coach_agent_once"],["vision_qc_agent","has_signal"],["_coach_agent_once","_distinct_ints"],["sectionize_pdf","_scan_pages_for_anchors"],["PDFTopologyAnalyzer.analyze_directory","PDFTopologyAnalyzer.analyze_pdf"],["process_pdf","_num_ok"],["vision_sectionize","norm_title"],["main","process_pdf"],["vision_sectionize","contains"],["_coach_sectionizer_once","_distinct_ints"],["main","analyze_directory"],["main","MassPDFScanner.scan_directory"],["orchestrate_pdf","_append_history"],["orchestrate_pdf","_distinct_ints"],["qc_financial","_to_float"],["vision_sectionize","_call_openai_compatible_vision"],["MassPDFScanner.scan_directory","_save_intermediate_json"],["MassPDFScanner.scan_directory","MassPDFScanner._is_already_scanned"],["vision_sectionize","add_pages"],["vertex_generate_text","_vertex_endpoint"],["vertex_generate_vision","_vertex_endpoint"],["enforce","_parse_num"],["main","_is_nonempty"]],"d":{"MASS_SCANNING_STATUS.md":["Mass PDF Scanning Status Report","\ud83d\udcca Current Progress","Checkpoint Database: `scan_progress.db`","\ud83d\ude80 Script Features","Resume Capability","Performance Optimization","Output Files","\ud83d\udcdd Usage Commands","Scan All Document Types (Recommended for Full Corpus)","Scan Specific Document Type"],".grok/GROK.md":["GROK.md - Customization for Grok Interactions in Gracian Pipeline","Default Configuration","Default System Prompt for Grok","Guidelines for BRF Extraction","Custom Prompts"],"CLAUDE.md":["Gracian Pipeline - Claude Code Quick Reference","\ud83d\ude80 Quick Start (First Thing After Context Loss)","\ud83d\udccb Project Overview","\ud83d\uddc4\ufe0f **CRITICAL: PDF Corpus Locations**","Total Corpus: **89,955 PDFs** (194GB)","PDF Topology (from 221-doc sample):","Estimated Processing (26,342 \u00e5rsredovisning):","\ud83d\udccd Key Files & Locations","Core Architecture","Configuration"],"PDF_TOPOLOGY_REPORT.md":["PDF Topology Analysis Report","\ud83d\udcca Executive Summary","Local Corpus Analysis (221 PDFs)","\ud83d\udd0d Detailed Analysis","1. Machine-Readable PDFs (48.4% - 107 files)","2. Scanned/Image-Based PDFs (49.3% - 109 files)","3. Hybrid PDFs (2.3% - 5 files)","\ud83d\udca1 Extraction Strategy Recommendations","Optimal Pipeline Architecture"],"README.md":["Gracian Pipeline","\ud83c\udfaf Overview","\ud83c\udfd7\ufe0f Architecture","Core Components","\ud83d\udce6 Installation","Prerequisites","Setup","Clone the repository","Install dependencies","Copy and configure environment"]},"deps":{"analyze_pdf_topology.py":["os","sys","argparse","json","pathlib","typing","collections","fitz  # PyMuPDF","psycopg2"],"gracian_pipeline/core/bench.py":["os","json","re","typing","openai","time","requests","os","time","openai","openai"],"gracian_pipeline/core/enforce.py":["__future__","os","re","typing"],"gracian_pipeline/core/oneshot.py":["__future__","os","json","typing","fitz  # type: ignore","pathlib"],"gracian_pipeline/core/orchestrator.py":["__future__","os","json","hashlib","threading","typing","concurrent.futures","json","json","fitz  # type: ignore","json","pathlib"],"gracian_pipeline/core/qc.py":["__future__","math","re","typing"],"gracian_pipeline/core/schema.py":["__future__","typing"],"gracian_pipeline/core/sectionizer.py":["__future__","re","typing","fitz  # PyMuPDF","fitz","fitz"],"gracian_pipeline/core/vertex.py":["__future__","base64","json","os","typing","google.oauth2","google.auth.transport.requests","requests"],"gracian_pipeline/core/vision_qc.py":["base64","io","os","typing","openai","time","fitz  # PyMuPDF","fitz  # PyMuPDF","json","re","openai","requests","time","openai","fitz  # type: ignore","fitz  # type: ignore","fitz  # type: ignore"],"gracian_pipeline/core/vision_sectionizer.py":["os","json","time","typing","fitz","openai","re","fitz","fitz","fitz"],"mass_scan_pdfs.py":["os","sys","argparse","json","sqlite3","time","pathlib","typing","collections","datetime","fitz  # PyMuPDF"],"run_gracian.py":["argparse","os","sys","glob","json","time","pathlib","prompts.agent_prompts","core.schema","core.vision_qc","core.sectionizer","core.vision_sectionizer","core.enforce","core.qc","core.bench","core.oneshot","core.orchestrator","dotenv","openai","fitz  # PyMuPDF","pdfplumber","fitz","json","os","fitz","core.bench","os","pathlib","fitz","re","fitz","core.vision_qc"],"tools/debug_agent.py":["__future__","os","json","argparse","pathlib","typing","sys","prompts.agent_prompts","core.schema","core.vision_qc","core.qc","core.enforce","core.bench","core.vision_sectionizer","dotenv"]},"dir_purposes":{},"staleness":1759137436.121957}